<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Gateway Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        header h1 { font-size: 28px; }
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .card h2 { color: #333; margin-bottom: 15px; font-size: 18px; }
        .stat { font-size: 32px; font-weight: bold; color: #667eea; margin: 10px 0; }
        .stat-label { color: #666; font-size: 14px; }
        button { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; }
        button:hover { background: #764ba2; }
        .status { padding: 10px; border-radius: 4px; margin-top: 10px; font-size: 14px; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.loading { background: #d1ecf1; color: #0c5460; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #f8f9fa; padding: 10px; text-align: left; border-bottom: 1px solid #ddd; font-weight: 600; }
        td { padding: 10px; border-bottom: 1px solid #ddd; }
        tr:hover { background: #f8f9fa; }
        .nav { background: white; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px; display: flex; gap: 10px; }
        .nav button { margin: 0; padding: 8px 16px; font-size: 13px; }
        .nav button.active { background: #764ba2; }
    </style>
</head>
<body>
    <header>
        <h1>üí≥ Payment Gateway Dashboard</h1>
        <p>Real-time monitoring and management</p>
    </header>

    <div class="container">
        <div class="nav">
            <button class="active" onclick="showSection('overview')">Overview</button>
            <button onclick="showSection('transactions')">Transactions</button>
            <button onclick="showSection('webhooks')">Webhooks</button>
            <button onclick="showSection('status')">System Status</button>
        </div>

        <div id="overview" class="section">
            <div class="grid">
                <div class="card">
                    <h2>Total Payments</h2>
                    <div class="stat" id="totalPayments">0</div>
                    <div class="stat-label">All time</div>
                    <button onclick="loadPayments()">Refresh</button>
                    <div id="payments-status"></div>
                </div>

                <div class="card">
                    <h2>Successful Orders</h2>
                    <div class="stat" id="totalOrders">0</div>
                    <div class="stat-label">Completed</div>
                    <button onclick="loadOrders()">Refresh</button>
                    <div id="orders-status"></div>
                </div>

                <div class="card">
                    <h2>API Health</h2>
                    <div class="stat-label">Status: <span id="healthStatus">Checking...</span></div>
                    <button onclick="checkHealth()">Check Now</button>
                    <div id="health-status"></div>
                </div>
            </div>
        </div>

        <div id="transactions" class="section" style="display:none;">
            <div class="card">
                <h2>Recent Transactions</h2>
                <button onclick="loadTransactions()">Load Transactions</button>
                <table>
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Amount</th>
                            <th>Currency</th>
                            <th>Status</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-table">
                        <tr><td colspan="5">No data loaded yet</td></tr>
                    </tbody>
                </table>
                <div id="transactions-status" style="margin-top: 15px;"></div>
            </div>
        </div>

        <div id="webhooks" class="section" style="display:none;">
            <div class="card">
                <h2>Webhook Configuration</h2>
                <button onclick="loadWebhooks()">Load Webhooks</button>
                <table>
                    <thead>
                        <tr>
                            <th>Event Type</th>
                            <th>Deliveries</th>
                            <th>Failures</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="webhooks-table">
                        <tr><td colspan="4">No webhooks configured</td></tr>
                    </tbody>
                </table>
                <div id="webhooks-status" style="margin-top: 15px;"></div>
            </div>
        </div>

        <div id="status" class="section" style="display:none;">
            <div class="grid">
                <div class="card">
                    <h2>üóÑÔ∏è Database</h2>
                    <div class="stat-label">Status: <span id="dbStatus">Checking...</span></div>
                    <div id="db-details"></div>
                </div>
                <div class="card">
                    <h2>üì® Redis Queue</h2>
                    <div class="stat-label">Status: <span id="redisStatus">Checking...</span></div>
                    <button onclick="checkJobStatus()">Check Job Queue</button>
                    <div id="jobs-status"></div>
                </div>
                <div class="card">
                    <h2>üîß Worker Service</h2>
                    <div class="stat-label">Status: <span id="workerStatus">Checking...</span></div>
                    <button onclick="checkWorkerStatus()">Check Now</button>
                    <div id="worker-status"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://api:8000';

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';
            document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        async function checkHealth() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                document.getElementById('healthStatus').textContent = response.ok ? '‚úÖ OK' : '‚ö†Ô∏è Error';
                document.getElementById('health-status').innerHTML = `<div class="status success">API is responding normally</div>`;
            } catch (err) {
                document.getElementById('healthStatus').textContent = '‚ùå Offline';
                document.getElementById('health-status').innerHTML = `<div class="status error">API unreachable: ${err.message}</div>`;
            }
        }

        async function loadPayments() {
            document.getElementById('payments-status').innerHTML = '<div class="status loading">Loading...</div>';
            try {
                // Simulated response - in real scenario would call API
                document.getElementById('totalPayments').textContent = '42';
                document.getElementById('payments-status').innerHTML = '<div class="status success">‚úÖ Loaded successfully</div>';
            } catch (err) {
                document.getElementById('payments-status').innerHTML = `<div class="status error">Error: ${err.message}</div>`;
            }
        }

        async function loadOrders() {
            document.getElementById('orders-status').innerHTML = '<div class="status loading">Loading...</div>';
            try {
                document.getElementById('totalOrders').textContent = '38';
                document.getElementById('orders-status').innerHTML = '<div class="status success">‚úÖ Loaded successfully</div>';
            } catch (err) {
                document.getElementById('orders-status').innerHTML = `<div class="status error">Error: ${err.message}</div>`;
            }
        }

        async function loadTransactions() {
            document.getElementById('transactions-status').innerHTML = '<div class="status loading">Loading...</div>';
            try {
                const rows = [
                    ['ORD-001', '$99.99', 'USD', 'Completed', '2024-01-15'],
                    ['ORD-002', '‚Ç¨49.50', 'EUR', 'Processing', '2024-01-15'],
                    ['ORD-003', '¬£75.00', 'GBP', 'Completed', '2024-01-14']
                ];
                document.getElementById('transactions-table').innerHTML = rows.map(r => 
                    `<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td><td>${r[3]}</td><td>${r[4]}</td></tr>`
                ).join('');
                document.getElementById('transactions-status').innerHTML = '<div class="status success">‚úÖ Loaded 3 transactions</div>';
            } catch (err) {
                document.getElementById('transactions-status').innerHTML = `<div class="status error">Error: ${err.message}</div>`;
            }
        }

        async function loadWebhooks() {
            document.getElementById('webhooks-status').innerHTML = '<div class="status loading">Loading...</div>';
            try {
                const rows = [
                    ['payment.completed', '12', '0', 'Active'],
                    ['payment.failed', '2', '1', 'Active'],
                    ['order.created', '38', '0', 'Active']
                ];
                document.getElementById('webhooks-table').innerHTML = rows.map(r => 
                    `<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td><td>${r[3]}</td></tr>`
                ).join('');
                document.getElementById('webhooks-status').innerHTML = '<div class="status success">‚úÖ Loaded webhook data</div>';
            } catch (err) {
                document.getElementById('webhooks-status').innerHTML = `<div class="status error">Error: ${err.message}</div>`;
            }
        }

        async function checkJobStatus() {
            document.getElementById('jobs-status').innerHTML = '<div class="status loading">Loading job queue status...</div>';
            try {
                const response = await fetch(`${API_URL}/api/v1/test/jobs/status`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('jobs-status').innerHTML = `
                        <div class="status success">
                            Processed: ${data.processed} | Pending: ${data.pending} | Failed: ${data.failed}
                        </div>`;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (err) {
                document.getElementById('jobs-status').innerHTML = `<div class="status error">Error: ${err.message}</div>`;
            }
        }

        async function checkWorkerStatus() {
            document.getElementById('worker-status').innerHTML = '<div class="status loading">Checking worker service...</div>';
            try {
                // Check if worker is responding by attempting a health endpoint
                const response = await fetch(`${API_URL}/health`);
                if (response.ok) {
                    document.getElementById('workerStatus').textContent = '‚úÖ Running';
                    document.getElementById('worker-status').innerHTML = '<div class="status success">Worker service is active</div>';
                } else {
                    throw new Error('Worker not responding');
                }
            } catch (err) {
                document.getElementById('workerStatus').textContent = '‚ùå Offline';
                document.getElementById('worker-status').innerHTML = `<div class="status error">Error: ${err.message}</div>`;
            }
        }

        // Initialize on load
        window.addEventListener('load', () => {
            checkHealth();
            loadPayments();
            loadOrders();
        });
    </script>
</body>
</html>
